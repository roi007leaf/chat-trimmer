<div class="chat-archive-viewer">
    <div class="archive-header">
        <h2>{{localize "CHATTRIMMER.ArchiveViewer.Title"}}</h2>
        <div class="archive-header-controls">
            <select class="archive-select" name="session">
                {{#each archives}}
                <option value="{{this.id}}" {{#if this.selected}}selected{{/if}}>
                    {{this.label}}
                </option>
                {{/each}}
            </select>
            <button type="button" class="delete-current-archive" data-action="deleteCurrentArchive" data-tooltip="{{localize 'CHATTRIMMER.Buttons.DeleteCurrentArchive'}}">
                <i class="fas fa-trash"></i>
            </button>
            <button type="button" class="delete-all-archives" data-action="deleteAllArchives" data-tooltip="{{localize 'CHATTRIMMER.Buttons.DeleteAllArchives'}}">
                <i class="fas fa-trash-alt"></i>
            </button>
        </div>
    </div>

    {{#if showArchiveBody}}
    <div class="archive-body">
        <div class="archive-controls">
            <div class="filter-group">
                <label>{{localize "CHATTRIMMER.ArchiveViewer.Filter"}}:</label>
                <select class="category-filter" name="filter">
                    <option value="all" {{#if (eq currentFilter "all")}}selected{{/if}}>
                        {{localize "CHATTRIMMER.Categories.All"}}
                    </option>
                    <option value="combat" {{#if (eq currentFilter "combat")}}selected{{/if}}>
                        ‚öîÔ∏è {{localize "CHATTRIMMER.Categories.Combat"}}
                    </option>
                    <option value="rolls" {{#if (eq currentFilter "rolls")}}selected{{/if}}>
                        üé≤ {{localize "CHATTRIMMER.Categories.Rolls"}}
                    </option>
                    <option value="speech" {{#if (eq currentFilter "speech")}}selected{{/if}}>
                        üí¨ {{localize "CHATTRIMMER.Categories.Speech"}}
                    </option>
                    <option value="emotes" {{#if (eq currentFilter "emotes")}}selected{{/if}}>
                        ‚ú® {{localize "CHATTRIMMER.Categories.Emotes"}}
                    </option>
                    <option value="whispers" {{#if (eq currentFilter "whispers")}}selected{{/if}}>
                        üí≠ {{localize "CHATTRIMMER.Categories.Whispers"}}
                    </option>
                    <option value="healing" {{#if (eq currentFilter "healing")}}selected{{/if}}>
                        ‚ù§Ô∏è {{localize "CHATTRIMMER.Categories.Healing"}}
                    </option>
                    <option value="items" {{#if (eq currentFilter "items")}}selected{{/if}}>
                        üì¶ {{localize "CHATTRIMMER.Categories.Items"}}
                    </option>
                    <option value="important" {{#if (eq currentFilter "important")}}selected{{/if}}>
                        ‚≠ê {{localize "CHATTRIMMER.Categories.Important"}}
                    </option>
                </select>
            </div>

            <div class="search-group">
                <input 
                    type="text" 
                    class="archive-search" 
                    placeholder="{{localize 'CHATTRIMMER.ArchiveViewer.Search'}}"
                    value="{{searchQuery}}"
                    name="search"
                />
            </div>
        </div>

        <div class="archive-stats">
            <span>
                {{localize "CHATTRIMMER.ArchiveViewer.Showing"}} 
                <strong>{{filteredEntries.length}}</strong> / <strong>{{totalEntries}}</strong>
            </span>
            <span>
                {{localize "CHATTRIMMER.ArchiveViewer.Compression"}}: 
                <strong>{{compressionRatio}}%</strong>
            </span>
        </div>

        <div class="archive-entries">
            {{#each filteredEntries}}
            {{#if this.isHeader}}
            <div class="archive-group-header">
                <span class="header-name">{{this.archiveName}}</span>
                <button type="button" class="header-delete-btn" data-action="deleteSpecificArchive" data-archive-id="{{this.archiveId}}" data-tooltip="{{localize 'CHATTRIMMER.Buttons.DeleteArchive'}}">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
            {{else}}
            <div class="archive-entry {{this.category}}" data-entry-id="{{this.id}}">
                <div class="entry-header" data-action="toggleEntry">
                    <span class="entry-icon">{{this.icon}}</span>
                    <div class="entry-header-content">
                        {{#if this.speaker}}<div class="entry-speaker">{{this.speaker}}</div>{{/if}}
                        <span class="entry-summary">{{#if this.displaySummary}}{{this.displaySummary}}{{else}}{{this.displayText}}{{/if}}</span>
                    </div>
                    <span class="entry-timestamp">{{formatTime this.timestamp}}</span>
                    <i class="fas fa-chevron-down toggle-icon"></i>
                </div>
                <div class="entry-content {{#unless this.expanded}}hidden{{/unless}}">
                    <div class="entry-original">{{{this.content}}}</div>
                    <div class="entry-actions">
                        {{#if this.rollButtonsHtml}}
                        <div class="entry-roll-buttons">{{{this.rollButtonsHtml}}}</div>
                        {{/if}}
                        <button class="view-original" data-action="viewOriginal" data-message-id="{{this.id}}">
                            <i class="fas fa-eye"></i> {{localize "CHATTRIMMER.Buttons.ViewOriginal"}}
                        </button>
                    </div>
                </div>
            </div>
            {{/if}}
            {{else}}
            <div class="no-entries">
                <p>{{localize "CHATTRIMMER.ArchiveViewer.NoEntries"}}</p>
            </div>
            {{/each}}
        </div>
    </div>
    {{else}}
    <div class="no-archive">
        <p>{{localize "CHATTRIMMER.ArchiveViewer.NoArchives"}}</p>
    </div>
    {{/if}}
</div>
